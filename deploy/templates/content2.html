<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="{{ url_for('static', filename='css/content2.css')}}" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>


    <title>ë™ê¸°ë¶€ì—¬ ë²„í‚·ë¦¬ìŠ¤íŠ¸</title>

    <style>
        

        

    </style>
    <script>
        var state = [0,0,0] // ê° ì…ë ¥ ë°•ìŠ¤ë“¤ì˜ ì—´ë¦¼/ë‹«í˜ ìƒíƒœ
        var emojis = [
            'ğŸŒˆ', 'ğŸ—', 'ğŸº', 'ğŸ®', 'ğŸœ', 'ğŸ§„','ğŸ’', 'ğŸ‘', 'ğŸ‰', 'ğŸ€', 'ğŸŒ±', 'ğŸ¤¹â€â™€ï¸','ğŸ¦œ', 'ğŸ·', 'ğŸ®', 'ğŸ¯',
            'ğŸ­', 'ğŸŒœ', 'â°', 'â›µ', 'ğŸšš', 'ğŸ—»', 'ğŸ«', 'ğŸ‚', 'ğŸ§†', 'ğŸ¥', 'ğŸ ', 'ğŸŸ', 'ğŸ™', 'ğŸ¦ˆ', 'ğŸ›', 'ğŸ¦‹',
            'ğŸ', 'ğŸ', 'ğŸ¦—', 'ğŸ¦•', 'ğŸ’»', 'ğŸ‘¨', 'ğŸ«¶', 'ğŸ’Œ', 'ğŸ’˜', 'ğŸ§™', 'ğŸ§š', 'ğŸ§œ', 'ğŸ¥‚', 'ğŸ¥ƒ', 'ğŸ»', 'ğŸ¹',
            'ğŸ¸', 'ğŸ·', 'ğŸ’', 'â­ï¸', 'ğŸ’§', 'ğŸª‚', 'ğŸ¨', 'ğŸ²', 'ğŸµ', 'ğŸ‡°ğŸ‡·', 'ğŸ', 'ğŸ”…', 'âœ…', 'ğŸ’ˆ', 'ğŸ¦ ', 'ğŸ§¸'
        ]
        var selected_emoji = 'ğŸŒˆ'
		var link=document.location.href
		const Url = decodeURI(link);
		var team_name = Url.slice(67,-1)
        $(document).ready(function () {
            show_bucket();
            list_emoji();
        });
        //ì¸ë±ìŠ¤ ë²ˆí˜¸ë¥¼ ë°›ì•„ ì´ëª¨ì§€ë¥¼ ì„ íƒí•œë‹¤.
        function emoji_select(e_index) {
            selected_emoji = emojis[e_index] //ì„ íƒëœ ì´ëª¨ì§€ var ë°˜ì˜
            for (let i = 0; i < emojis.length; i++) { // ì „ì²´ ì´ëª¨ì§€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ì„ í´ë¦­ë˜ì§€ ì•Šì€ ìŠ¤íƒ€ì¼ë¡œ ë³€ê²½
                $('#emo' + i).css('background-color', '#f7f2e4')
            }
            $('#selected_emoji').text(emojis[e_index]) // 'ì´ëª¨ì§€ì„ íƒ:' ë²„íŠ¼ì— ë°˜ì˜
            $('#emo' + e_index).css('background-color', ' #FDD875') //ì„ íƒëœ ì´ëª¨ì§€ ë²„íŠ¼ì„ ì–´ë‘¡ê²Œ ë³€ê²½
        }
        //ì´ëª¨ì§€ ì„ íƒì°½ì„ ë™ì ìœ¼ë¡œ ìƒì„±
        function list_emoji() {
            $('#emojibox').hide()// ì°½ ìˆ¨ê¸°ê³  ì‹œì‘
            for (let i = 0; i < emojis.length; i++) {//ië¡œ idì§€ì •, í•¨ìˆ˜í˜¸ì¶œ
                temp_html = `<button class="emobtn" id="emo${i}" onclick="emoji_select(${i})">${emojis[i]}</button>`
                $('#emojibox').append(temp_html)
            }
            $('#emo' + 0).css('background-color', '#dbad43')//ê¸°ë³¸ ì´ëª¨ì§€ ì„ íƒë¨ í‘œì‹œ
        }

        function show_bucket() {
            $('#bucket-list').empty()
			$('#team_name').text(team_name)
            $.ajax({
                type: "GET",
                url: "/list/"+team_name+'/data',
                data: {},
                success: function (response) {
                    
                    let rows = response['result']
                    if (rows.length ==0){
                        let temp_html = `<h2>ì•„ì§ ë²„í‚·ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤!</h2>
                                        <h5>ì§€ê¸ˆ ì²« ë²„í‚·ë¦¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ ë³´ì„¸ìš”</h5>`
                        $('#bucket-list').append(temp_html)
                        return;
                    }

                    let total_done = response['total_done']
                        let total_rows = rows.length
                        let total =`df`

                        

                    if (total_done == 0){
                        let total2 = `ë²„í‚·ì„ ì™„ë£Œí•˜ë©´ í•˜íŠ¸ê°€ ìƒê²¨ìš”~!`
                        $('#bucket-list').append(total2)
                    }           

                    for (let i = 0; i <= total_done; i++){
                            if (i == 0){
                                total=``
                            } else {
                                total='ğŸ§¡'
                            }
                            
                        $('#bucket-list').append(total)                     
                    }






					console.log(rows)
                    for (let i = 0; i < rows.length; i++) {
                        let bucket = rows[i]['content']
                        let done = rows[i]['done']
                        let num = rows[i]['num']
                        let name = rows[i]['name']
                        let date = rows[i]['date']
                        let star = rows[i]['star']
                        let emo = rows[i]['emo']

                        


                        let year = new Date(date).getFullYear().toString()
                        let month = new Date(date).getUTCMonth() + 1
                        let day = new Date(date).getUTCDate()
                        let strdate = `${year}.${month}.${day}`

                        let temp_html = `<h2>ì•„ì§ ë²„í‚·ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤!</h2>
                                        <h5>ì§€ê¸ˆ ì²« ë²„í‚·ë¦¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ ë³´ì„¸ìš”</h5>`
                        if (done == 0) {
                            temp_html = `<div style="margin-bottom:60px; margin-top:30px; list-style:none;">
                                    <h2>${emo}&nbsp;&nbsp;${bucket}</h2><br>
                                    <h5 style="text-align:right;">ì¤‘ìš”ë„ : ${star}&nbsp;&nbsp; ì‘ì„±ì : ${name} &nbsp;&nbsp;(${strdate})</h5><br>
                                    <button onclick="toggle_bucket(${num},${1})" type="button" class = "btn text-white" 
                                        style="border:1px solid coral; background-color: coral; border-radius: 5px; display:inline-block; float:right;">ì™„ë£Œ!</button>
                                    <button onclick="delete_bucket(${num})" type="button"  class = "btn" 
                                        style=" border:1px solid coral; border-radius: 5px; color: coral; background-color:white; display:inline-block; float:left;">ì‚­ì œ!</button>
                                </div><hr>`
                        } else {
                            temp_html = `<div style="margin-bottom:60px; margin-top:30px; list-style:none;">
                                    <h2>ğŸ’¯&nbsp;&nbsp;<span class="txt-bg3">ğŸ‰ğŸ‰ğŸ‰${bucket}ğŸ‰ğŸ‰ğŸ‰</span></h2><br>
                                    <h5 style="text-align:right;">ì‘ì„±ì : ${name} &nbsp;&nbsp;(${strdate})</h5><br>
                                    <button onclick="toggle_bucket(${num}, ${0})" type="button" class="btn text-white"   
                                        style="border:1px solid coral; background-color: coral; border-radius: 5px; display:inline-block; float:right;">ì™„ë£Œ ì·¨ì†Œ!</button>
                                    <button onclick="delete_bucket(${num})" type="button" class = "btn" 
                                        style= "border: 1px solid coral; color: coral; border-radius: 5px; background-color:white; display:inline-block; float:left;">ì‚­ì œ!</button>
                                </div><hr>`
                        }

    
                        $('#bucket-list').append(temp_html)
                        
                    }
                    
                }
            });
        }


        function save_bucket() {
            let bucket = $('#bucket').val()
            let name = $('#floatingInput').val()
            let star = $("select[name=star] option:selected").text()
            let emo = selected_emoji
            if (bucket.trim() =='' || name.trim()==''){
                alert("ë‚´ìš©ê³¼ ì‘ì„±ìì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”")
                return ;
            }
            $.ajax({
                type: "POST",
                url: "/list/"+team_name,
                data: {content_give: bucket,
                        star_give: star,
                        name_give: name,
                        emo_give: emo},
                success: function (response) {
                    if (response["msg"]=='ë²„í‚·ë¦¬ìŠ¤íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.'){
                        alert(response["msg"])
                        window.location.reload()
                    } else {
                        alert(response["msg"])
                    }
                    
                }
            });
        }


        function toggle_bucket(num, state){
            $.ajax({
                type: "PUT",
                url: "/list/"+team_name,
                data: {'num_give': num, 'state_give': state},
                success: function (response) {
                    alert(response["msg"])
                    console.log(response)
                    window.location.reload()
                }
            });
        }

        function delete_page(){
			let input_pw = $('#writePW').val()
			let input_leader_name=$('#writeName').val()
            $.ajax({
                type: "DELETE",
                url: "/teams/"+team_name,
                data: {'input_pw_give':input_pw, 'input_leader_name_give':input_leader_name},
                success: function (response) {
                    if(response['result']=='success'){
                        alert(response["msg"])
                        console.log(response)
                        window.location.href = '/'
                    }
                    else{
                        alert(response["msg"])
                    }
                    
                }
            });
        }
        
        function delete_bucket(num){
            if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ??") == true) {    //í™•ì¸
                $.ajax({
                type: "DELETE",
                url: "/list/"+team_name,
                data: {'num_give': num},
                success: function (response) {
                    alert(response["msg"])
                    console.log(response)
                    window.location.reload()
                }
            });
            } else {   //ì·¨ì†Œ
                return false;
            }            
        }

        function open_box(){
            if (state[0]==0){
                $('#post-box').show()
                state[0]=1
            }
            else{
                $('#post-box').hide()
                state[0]=0
            }
        }

        function open_deletebox(){
            if (state[1]==0){
                $('#delete-box').show()
                state[1]=1
            }
            else{
                $('#delete-box').hide()
                state[1]=0
            }
        }
        function open_emojibox() {
            if (state[2] == 0) {
                $('#emojibox').show()
                state[2] = 1
            }
            else {
                $('#emojibox').hide()
                state[2] = 0
            }
        }
    
        function hey(){
            alert('í ì´ê²ƒë„ ê°€ì§œì§€ë¡±~');
        }	

       
    </script>
</head>
<body>
    <div class = "wrap">
        <div class="mypic">
            <br><br><br><br><br><br>
            <h2 id="team_name">í•˜ì´</h2>
            <br>
            <div class="button">
                <button onclick="open_box()"  >ê¸°ë¡í•˜ê¸°</button>
                <button onclick="location.href='/'"   >í™ˆ</button>
                <button onclick="open_deletebox()"  >í˜ì´ì§€ ì‚­ì œ</button>
            </div>

        </div>

        <div class="fake">
            <button class="fake_egg" onclick="hey()"> í´ë¦­! </button>
        </div>   
        <div class="search" style="margin-bottom: 20px; margin: 0px auto; text-align: center; ">
            <form action="https://www.melon.com/search/total/index.htm?"  method="GET" target="_blank">
                <input placeholder="ë“£ê³  ì‹¶ì€ ìŒì•… ê²€ìƒ‰" name="q" type="text"  style="width:200px;height: 40px; border-color: transparent; border-radius: 10px; margin-right: 5px;">
                <button onclick="music()" style="width: 60px; height: 40px;background-color: coral; color:white; border-radius: 10px;border-color: transparent; ">ê²€ìƒ‰</button>
            </form>
        </div>     
            
        <div class="mybox" id="post-box">
            <div class="form-floating mb-3">
                <input type="email" class="form-control" id="floatingInput" placeholder="name@example.com">
                <label for="floatingInput">ì´ë¦„</label>
            </div>

            <div class="input-group mb-3">
                <label class="input-group-text" for="inputGroupSelect01">ì¤‘ìš”ë„</label>
                <select name="star" class="form-select" id="inputGroupSelect01">
                    <option selected>&#45;&#45;ì„ íƒí•˜ê¸°&#45;&#45;</option>
                    <option value="1">â­</option>
                    <option value="2">â­â­</option>
                    <option value="3">â­â­â­</option>
                    <option value="3">â­â­â­â­</option>
                    <option value="3">â­â­â­â­â­</option>
                </select>
            </div>
            

            <div class="mybucket">
                <input class="form-control" id="bucket" type="text" placeholder="ì´ë£¨ê³  ì‹¶ì€ ê²ƒì„ ì…ë ¥í•˜ì„¸ìš”">
                <button onclick="open_emojibox()" type="button">ì•„ì´ì½˜ ì„ íƒ:<span id="selected_emoji">ğŸŒˆ</span></button>
                <div class="emojibox" id="emojibox">

                </div>
                <button onclick="save_bucket()" type="button">ê¸°ë¡í•˜ê¸°</button>
            </div>
        </div>

        <div class="deleteBox" id="delete-box">
                <input type="email" class="form-control" id="writeName" placeholder="íŒ€ì¥ì´ë¦„">
                <input class="form-control" id="writePW" type="text" placeholder="ë¹„ë°€ë²ˆí˜¸">
                <button onclick="delete_page()" type="button" >ì‚­ì œí•˜ê¸°</button>

        </div>
        <div class="mybox2" id="bucket-list">
            <button onclick="delete_page()" type="button" >ì‚­ì œí•˜ê¸°</button>
        </div>

        <h6>copyright Â© c.p.u</h6>
    </div>
</body>
</html>